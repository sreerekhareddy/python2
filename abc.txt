import os
import pandas as pd
from openpyxl import load_workbook

failed_rings = []
successful_rings = []

# Define the Excel file path
excel_file_path = 'D:\\New folder (3)\\VerifyModelsReportCI.xlsx'

# ✅ Step 1: Open and Save the Workbook (This enables editing)
wb = load_workbook(excel_file_path)
wb.save(excel_file_path)  # This ensures that Excel is properly opened & saved
wb.close()  # Close to release the file for pandas

workbook = pd.ExcelFile(excel_file_path)
sheet = pd.read_excel(workbook, 'Results')
data = pd.DataFrame(sheet, columns=['Ring', 'Mandatory'])

for i in data.index:
    ring = data.at[i, 'Ring']
    mandatory = data.at[i, 'Mandatory']

    if pd.notna(ring):  # Check if 'Ring' is not NaN
        # If Mandatory is empty or just spaces -> Successful Rings
        if pd.isna(mandatory) or str(mandatory).strip() == '':
            if ring not in successful_rings and ring not in failed_rings:
                successful_rings.append(ring)
        # If Mandatory contains any value -> Failed Rings
        else:
            if ring in successful_rings:
                successful_rings.remove(ring)
            if ring not in failed_rings:
                failed_rings.append(ring)

# ✅ Step 4: Print results
print("Failed Rings:", failed_rings)
print("Successful Rings:", successful_rings)
